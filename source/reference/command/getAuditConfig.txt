==============
getAuditConfig
==============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Definition
----------

.. dbcommand:: getAuditConfig

   .. versionadded:: 5.0

   :dbcommand:`getAuditConfig` is an administrative command that
   retrieves audit configurations from :binary:`~bin.mongod` and
   :binary:`~bin.mongos` server instances.

   Use the
   :method:`db.adminCommand( { command } )<db.adminCommand()>` method
   to run :dbcommand:`getAuditConfig` in the ``admin`` database.

   .. code-block:: javascript

      db.admin.runCommand( { getAuditConfig: 1 } )

Behavior
--------

:doc:`Auditing </core/auditing>` must be enabled in order to use
:dbcommand:`getAuditConfig`.

Nodes that are not participating in a runtime audit configuration
return their current configuration file settings for
``auditLog.filter`` and ``setParameter.auditAuthorizationSuccess``.

``mongos`` nodes that are participating in the runtime audit
configuration pass the command through to any available config server.
The ``mongos`` instance will also update its local cache with the audit
configuration settings. ``mongod`` nodes that are participating in
runtime audit configuration, synthesize their current configuration
from memory.

.. note::

   If you are writing automated audit scripts, note that the quoting
   style and the types used to represent the cluster signature differ
   between ``mongosh`` and the legacy ``mongo`` shell. In ``mongosh``
   the types are Binary and Long. The corresponding types in the legacy
   shell are BinData and NumberLong.

   .. code-block:: javascript
      :copyable: false

      // mongosh
      signature: {
         hash: Binary(Buffer.from("0000000000000000000000000000000000000000", "hex"), 0),
         keyId: Long("0")
      }

      // mongo
      "signature" : {
			      "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			      "keyId" : NumberLong(0)
		    }

Examples
--------

Run :dbcommand:`getAuditConfig` on the ``admin`` database .

.. code-block:: javascript

   db.admin.runCommand({getAuditConfig: 1})

The example server is configured to audit read and write operations. It
has a filter which captures the desired operations and the
``auditAuthorizationSuccess`` value has been set to ``true``.

.. code-block:: javascript
   :copyable: false
   :emphasize-lines: 3-7, 9

   {
     generation: ObjectId("60e73e74680a655705f16525"),
     filter: {
       atype: 'authCheck',
       'param.command': {
         '$in': [ 'find', 'insert', 'delete', 'update', 'findandmodify' ]
       }
     },
     auditAuthorizationSuccess: true,
     ok: 1,
     '$clusterTime': {
       clusterTime: Timestamp(1, 1625767540),
       signature: {
         hash: Binary(Buffer.from("0000000000000000000000000000000000000000", "hex"), 0),
         keyId: Long("0")
       }
     },
     operationTime: Timestamp(1, 1625767540)
   }

.. seealso::

   :method:`db.adminCommand`, :doc:`configure audit filters</tutorial/configure-audit-filters>`

